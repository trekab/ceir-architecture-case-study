<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" viewBox="0 0 1200 720">
  <defs>
    <style>
      .title { font: 700 28px Arial, sans-serif; fill: #1f2a37; }
      .subtitle { font: 400 16px Arial, sans-serif; fill: #374151; }
      .label { font: 600 14px Arial, sans-serif; fill: #111827; }
      .text { font: 400 13px Arial, sans-serif; fill: #111827; }
      .muted { fill: #6b7280; font: 400 12px Arial, sans-serif; }
      .box { fill: #f9fafb; stroke: #111827; stroke-width: 2; rx: 14; }
      .boxFocus { fill: #eef2ff; stroke: #111827; stroke-width: 3; rx: 16; }
      .boxMuted { fill: #ffffff; stroke: #9ca3af; stroke-width: 2; stroke-dasharray: 8 6; rx: 14; }
      .arrow { stroke: #111827; stroke-width: 3; fill: none; marker-end: url(#arrow); }
      .arrowMuted { stroke: #6b7280; stroke-width: 2; fill: none; marker-end: url(#arrowMuted); }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#111827"/>
    </marker>
    <marker id="arrowMuted" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#6b7280"/>
    </marker>
  </defs>

  <text x="60" y="60" class="title">CEIR Architecture (Case Study Focus: Real-Time CheckIMEI Ingestion)</text>
  <text x="60" y="88" class="subtitle">CEIR is broader; this diagram highlights the highest-throughput integration path and its OLTP/OLAP split.</text>

  <!-- Focus pipeline -->
  <rect x="90" y="140" width="330" height="90" class="boxFocus"/>
  <text x="110" y="172" class="label">MNO / Clients</text>
  <text x="110" y="196" class="text">CheckIMEI events + integration calls</text>
  <text x="110" y="218" class="muted">High burst + retry tolerance</text>

  <rect x="460" y="140" width="330" height="90" class="boxFocus"/>
  <text x="480" y="172" class="label">Rails Integration API (Stateless)</text>
  <text x="480" y="196" class="text">Idempotency • Validation orchestration</text>
  <text x="480" y="218" class="muted">Horizontally scalable behind LB</text>

  <rect x="830" y="140" width="300" height="90" class="box"/>
  <text x="850" y="172" class="label">PostgreSQL (OLTP)</text>
  <text x="850" y="196" class="text">Authoritative decisions + audit</text>
  <text x="850" y="218" class="muted">Optimized hot paths (indexes, plans)</text>

  <rect x="460" y="280" width="330" height="90" class="box"/>
  <text x="480" y="312" class="label">Kafka Event Bus</text>
  <text x="480" y="336" class="text">Durable stream • partitioned scale</text>
  <text x="480" y="358" class="muted">Replayable for recovery</text>

  <rect x="460" y="420" width="330" height="90" class="box"/>
  <text x="480" y="452" class="label">Spark Streaming</text>
  <text x="480" y="476" class="text">Normalize • Enrich • Transform</text>
  <text x="480" y="498" class="muted">Backpressure-aware processing</text>

  <rect x="460" y="560" width="330" height="90" class="box"/>
  <text x="480" y="592" class="label">ClickHouse (OLAP)</text>
  <text x="480" y="616" class="text">Analytics • reporting • investigations</text>
  <text x="480" y="638" class="muted">Isolated from OLTP latency</text>

  <!-- arrows -->
  <path d="M 420 185 L 460 185" class="arrow"/>
  <path d="M 790 185 L 830 185" class="arrow"/>
  <path d="M 625 230 L 625 280" class="arrow"/>
  <path d="M 625 370 L 625 420" class="arrow"/>
  <path d="M 625 510 L 625 560" class="arrow"/>

  <!-- Broader CEIR callouts -->
  <rect x="90" y="310" width="300" height="110" class="boxMuted"/>
  <text x="110" y="342" class="label">Broader CEIR (not detailed here)</text>
  <text x="110" y="368" class="text">National List management workflows</text>
  <text x="110" y="390" class="text">User/role management (Rails)</text>
  <text x="110" y="412" class="text">Admin tooling + reporting UI</text>

  <rect x="830" y="310" width="300" height="110" class="boxMuted"/>
  <text x="850" y="342" class="label">Additional Pipelines</text>
  <text x="850" y="368" class="text">GSMA reference data ingestion</text>
  <text x="850" y="390" class="text">Batch imports / reconciliation</text>
  <text x="850" y="412" class="text">Data quality & enrichment jobs</text>

  <!-- muted arrows connecting broader context -->
  <path d="M 390 365 L 460 325" class="arrowMuted"/>
  <path d="M 790 325 L 830 365" class="arrowMuted"/>

  <!-- Legend -->
  <rect x="90" y="560" width="300" height="90" class="box"/>
  <text x="110" y="592" class="label">Legend</text>
  <text x="110" y="616" class="text">Bold boxes: Case study focus path</text>
  <text x="110" y="638" class="muted">Dashed boxes: Other CEIR subsystems</text>
</svg>
